<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GÃ©nÃ©rateur d'Ã‰tiquettes â€” La Fabuleuse Cantine</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <h1>ğŸº GÃ©nÃ©rateur d'Ã‰tiquettes</h1>
  <span>LA FABULEUSE CANTINE Â· LE BOCAL</span>
</header>

<div class="workspace">

  <!-- â”€â”€â”€ FORM â”€â”€â”€ -->
  <div class="form-panel">

    <div class="section-title">ğŸ§¾ Historique & Formats</div>

    <label>Historique plats / Ã©tiquettes</label>
    <select id="history-select" onchange="onSelectHistory(this.value)"></select>
    <div class="muted-help">
      Astuce : lâ€™outil garde aussi un <b>brouillon auto</b> (localStorage). Utilise â€œEnregistrerâ€ pour figer une version dans lâ€™historique.
    </div>

    <div class="row-2">
      <button class="btn-secondary" onclick="saveToHistory()">â­ Enregistrer</button>
      <button class="btn-secondary" onclick="duplicateDish()">ğŸ§¬ Dupliquer</button>
    </div>
    <div class="row-2">
      <button class="btn-danger" onclick="deleteFromHistory()">ğŸ—‘ï¸ Supprimer</button>
      <button class="btn-secondary" onclick="newDish()">â• Nouveau</button>
    </div>

    <label>Format dâ€™Ã©tiquette</label>
    <select id="format-select" onchange="setFormat(this.value)"></select>

    <div class="toggle-row">
      <input type="checkbox" id="bg-enabled" onchange="setBackgroundMode(getSelectedBackgroundMode())" checked>
      <label for="bg-enabled">Fond â€œvraie Ã©tiquetteâ€ (EPS converti)</label>
    </div>
    <div class="toggle-row">
      <input type="checkbox" id="bg-bio" onchange="applyBackgroundCSS()">
      <label for="bg-bio">Version Ã©tiquette BIO (utilise les fichiers *-bio.png)</label>
    </div>
    <label>Fond (selon format)</label>
    <select id="bg-select" onchange="setBackgroundMode(this.value)"></select>
    <div class="muted-help">
      Le navigateur ne peut pas afficher un <b>EPS</b> directement : mets tes EPS dans <code>assets/eps/</code> et utilise des versions <b>PNG/SVG</b> dans <code>assets/backgrounds/</code>.
    </div>

    <div class="section-title">ğŸ› ï¸ Calibration (DEV temporaire)</div>
    <button class="btn-secondary" type="button" onclick="toggleDevMode()">Activer / dÃ©sactiver le mode calibration</button>
    <button class="btn-secondary" type="button" onclick="copyCalibrationConfig()">Copier la config JSON</button>
    <textarea id="dev-config-output" readonly style="width:100%;min-height:90px;margin-top:8px;font-size:0.7rem;background:#0b0b17;border:1px solid #2a2a4a;color:#9ff;"></textarea>
    <div class="dev-note">
      Mode calibration: dÃ©place les blocs de texte directement sur lâ€™Ã©tiquette, puis copie-colle le JSON ici dans la conversation. On lâ€™intÃ¨grera dÃ©finitivement et on supprimera cet outil.
    </div>

    <div class="section-title">ğŸ½ï¸ Produit</div>

    <label>Type de plat</label>
    <div class="badge-type" id="type-buttons">
      <button class="active" data-type="Plat" onclick="setType('Plat', this)">Plat</button>
      <button data-type="Tapas" onclick="setType('Tapas', this)">Tapas</button>
      <button data-type="Soupe" onclick="setType('Soupe', this)">Soupe</button>
      <button data-type="Dessert" onclick="setType('Dessert', this)">Dessert</button>
      <button data-type="EntrÃ©e" onclick="setType('EntrÃ©e', this)">EntrÃ©e</button>
      <button data-type="Sauce" onclick="setType('Sauce', this)">Sauce</button>
      <button data-type="" onclick="setType('', this)">Autreâ€¦</button>
    </div>
    <input type="text" id="custom-type" placeholder="Type personnalisÃ©" oninput="update()" style="display:none">

    <label>Nom du plat</label>
    <input type="text" id="product-name" placeholder="ex : Wok Asiatique et Pancetta de Veau" oninput="update()">

    <label>Sous-titre / Tagline</label>
    <input type="text" id="tagline" value="LOCAL, DE SAISON ET FAIT MAISON" oninput="update()">

    <div class="section-title">ğŸ“‹ IngrÃ©dients & Nutrition</div>

    <label>IngrÃ©dients</label>
    <textarea id="ingredients" placeholder="Nouilles chinoises au blÃ© (50%) - LÃ©gumes (12%) : Poireaux, choux, oignonsâ€¦" oninput="update()"></textarea>

    <div class="row-2">
      <div>
        <label>Ã‰nergie (kJ)</label>
        <input type="number" id="kj" placeholder="2456" oninput="update()">
      </div>
      <div>
        <label>Ã‰nergie (kcal)</label>
        <input type="number" id="kcal" placeholder="486" oninput="update()">
      </div>
    </div>
    <div class="row-2">
      <div>
        <label>ProtÃ©ines (g)</label>
        <input type="number" id="proteins" placeholder="21.2" step="0.1" oninput="update()">
      </div>
      <div>
        <label>Glucides (g)</label>
        <input type="number" id="carbs" placeholder="15" step="0.1" oninput="update()">
      </div>
    </div>
    <div class="row-2">
      <div>
        <label>Lipides (g)</label>
        <input type="number" id="fats" placeholder="8" step="0.1" oninput="update()">
      </div>
      <div>
        <label>Poids net (g)</label>
        <input type="number" id="weight" placeholder="300" oninput="update()">
      </div>
    </div>

    <div class="section-title">ğŸ³ Service</div>

    <label>Mode de service</label>
    <div class="badge-type" id="serve-buttons">
      <button class="active" data-serve="Servir chaud" onclick="setServe('Servir chaud', this)">Chaud</button>
      <button data-serve="Servir froid" onclick="setServe('Servir froid', this)">Froid</button>
      <button data-serve="Ã€ tempÃ©rature ambiante" onclick="setServe('Ã€ tempÃ©rature ambiante', this)">Ambiant</button>
    </div>

    <div class="row-2">
      <div>
        <label>Bain-marie (min)</label>
        <input type="number" id="bain-marie" placeholder="10" oninput="update()">
      </div>
      <div>
        <label>Micro-ondes (min)</label>
        <input type="number" id="micro" placeholder="5" oninput="update()">
      </div>
    </div>

    <div class="section-title">âš—ï¸ Conservation & TraÃ§abilitÃ©</div>

    <label>TempÃ©rature de conservation</label>
    <input type="text" id="storage-temp" value="Entre 2 et 4Â°C" oninput="update()">

    <label>Consommation aprÃ¨s ouverture</label>
    <input type="text" id="storage-after" value="Dans les 24h" oninput="update()">

    <label>AllergÃ¨nes (note)</label>
    <input type="text" id="allergens" value="Peut contenir une prÃ©sence fortuite d'allergÃ¨nes dans les aliments." oninput="update()">

    <div class="row-2">
      <div>
        <label>Ã€ consommer avant</label>
        <input type="date" id="best-before" oninput="update()">
      </div>
      <div>
        <label>NÂ° de lot</label>
        <input type="text" id="lot" placeholder="LOT-00001" oninput="update()">
      </div>
    </div>

    <div class="section-title">ğŸŒ¿ QR Code</div>

    <label>URL du QR code</label>
    <input type="text" id="qr-url" placeholder="https://lafabuleusecantine.fr" value="https://lafabuleusecantine.fr" oninput="updateQR()">

    <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ Imprimer / Exporter PDF</button>
    <button class="btn-secondary" onclick="exportPNG()">ğŸ–¼ï¸ Export PNG (HD)</button>
    <button class="btn-secondary" onclick="saveHTML()">ğŸ’¾ Sauvegarder HTML</button>

  </div>

  <!-- â”€â”€â”€ PREVIEW â”€â”€â”€ -->
  <div class="preview-panel">
    <h2>APERÃ‡U EN TEMPS RÃ‰EL</h2>

    <div id="label-preview">

      <!-- LEFT HALF -->
      <div class="label-left">
        <div class="label-logo-area template-only">
          <div class="label-logo template-only">
            LFC
            <small>RENVERSER<br>LA TABLE</small>
          </div>
        </div>

        <div class="label-brand template-only">LE BOCAL</div>
        <div class="label-tagline template-only" id="lbl-tagline">LOCAL, DE SAISON ET FAIT MAISON</div>
        <div class="label-divider template-only"></div>

        <div id="lbl-type-badge" class="label-type-badge" data-draggable="1" data-key="typeBadge">Plat</div>
        <div class="label-product-name" id="lbl-product-name" data-draggable="1" data-key="productName">NOM DU PLAT</div>
        <div class="label-divider template-only"></div>

        <div class="label-serving" id="lbl-serving" data-draggable="1" data-key="serving">
          <span id="lbl-serve-mode">Servir chaud</span>
          <span class="time-box" id="lbl-bm">BM 10 min.</span>
          <span class="time-box" id="lbl-micro">Micro 5 min.</span>
        </div>

        <div class="label-discover template-only">DÃ©couvrez notre univers</div>
        <div class="label-qr" id="qr-container" data-draggable="1" data-key="qr"></div>
      </div>

      <!-- RIGHT HALF -->
      <div class="label-right" data-draggable="1" data-key="rightColumn">
        <span class="section-label template-only">IngrÃ©dients :</span>
        <span id="lbl-ingredients" data-draggable="1" data-key="ingredients">â€“</span>

        <div class="stars template-only">â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…</div>

        <span class="section-label template-only">Valeurs nutritionnelles :</span>
        <span id="lbl-nutrition" data-draggable="1" data-key="nutrition">â€“</span>
        <em class="template-only" style="font-size:0.5rem; color:#555">Valeurs moyennes par bocal</em>

        <div class="stars template-only">â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…</div>

        <span id="lbl-allergens" data-draggable="1" data-key="allergens">â€“</span>
        <span id="lbl-storage" data-draggable="1" data-key="storage">â€“</span>

        <div class="stars template-only">â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…â˜…</div>

        <span class="section-label template-only">Ã€ consommer jusqu'au :</span>
        <span id="lbl-best-before" data-draggable="1" data-key="bestBefore">00/00/0000</span>
        <span id="lbl-lot" data-draggable="1" data-key="lot">LOT NÂ°00000</span>

        <div id="lbl-bio-badges" class="bio-badges" data-draggable="1" data-key="bioBadges">
          <span class="ab-badge">AB</span>
          <span class="eu-bio">Agriculture Biologique<br>CertifiÃ© FR-BIO-09</span>
        </div>
      </div>

      <div class="label-bottom-text template-only">LA FABULEUSE CANTINE</div>

    </div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
